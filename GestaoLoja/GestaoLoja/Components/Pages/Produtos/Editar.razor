@page "/produtos/editar/{id:int}"

@inject ApplicationDbContext db
@inject NavigationManager nav

<h3>Editar Produto</h3>

@if (produto == null)
{
    <p>A carregar...</p>
}
else
{
    <div class="mb-3">
        <label class="form-label">Nome</label>
        <input class="form-control" @bind="produto.Nome" />
    </div>

    <div class="mb-3">
        <label class="form-label">Preço Base</label>
        <input class="form-control" type="number" step="0.01" @bind="produto.PrecoBase" />
    </div>

    <div class="mb-3">
        <label class="form-label">Percentagem</label>
        <input class="form-control" type="number" step="0.01" @bind="produto.Percentagem" />
    </div>

    <div class="mb-3">
        <label class="form-label">Stock</label>
        <input class="form-control" type="number" @bind="produto.Stock" />
    </div>

    <div class="mb-3">
        <label class="form-label">Estado</label>
        <select class="form-select" @bind="produto.Estado">
            <option value="Pendente">Pendente</option>
            <option value="Activo">Activo</option>
            <option value="Inactivo">Inactivo</option>
        </select>
    </div>

    <div class="mb-3">
        <label class="form-label">Categoria</label>
        <select class="form-select" @bind="produto.CategoriaId">
            @foreach (var c in categorias)
            {
                <option value="@c.Id">@c.Nome</option>
            }
        </select>
    </div>

    <div class="mb-3">
        <label class="form-label">Modo de Entrega</label>
        <select class="form-select" @bind="produto.ModoEntregaId">
            @foreach (var m in modos)
            {
                <option value="@m.Id">@m.Tipo</option>
            }
        </select>
    </div>

    <button class="btn btn-success" @onclick="Guardar">Guardar</button>
    <button class="btn btn-secondary" @onclick='() => nav.NavigateTo("/produtos")'>Cancelar</button>
}

@code {
    [Parameter] public int id { get; set; }

    Produtos produto;
    List<Categorias> categorias;
    List<ModoEntrega> modos;

    protected override void OnInitialized()
    {
        produto = db.Produtos.First(p => p.Id == id);
        categorias = db.Categorias.OrderBy(c => c.Nome).ToList();
        modos = db.ModosEntrega.OrderBy(m => m.Tipo).ToList();
    }

    void Guardar()
    {
        produto.PrecoFinal = produto.PrecoBase + (produto.PrecoBase * produto.Percentagem / 100);

        db.SaveChanges();
        nav.NavigateTo("/produtos");
    }
}
